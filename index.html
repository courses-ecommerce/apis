<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form id="payment-form" action="/api/payment/checkout" method="post">
        <input type="radio" name="paymentMethod" value="vnPay" checked id="">
        <label for="">VnPay</label>
        <br>
        <input type="button" name="btn_payment" value="Payment" onclick="postPaymentForm()">
    </form>

    <form action="/api/coupons/export-sheet" method="post">
        <input type="string" name="access_token"
            value="ya29.a0ARrdaM_N3kQCS_WAynaFmY8IhAdUWsjjZ08oAPbhimbEmi-8CA9XAY9yUpRcnKOJM2VRmpq0F9wVhKK8PCq8J2vnQnmlgl-wn3gqQRBPgRbMsZ_RDfWVZtZcQ4STLCV6NyKcmMWaXxNMnAVI2ri17UCxQY4s"
            id="btn-export">
        <input type="string" name="refresh_token"
            value="1//0gMsF5AsIUVL_CgYIARAAGBASNgF-L9IrDep70S4JN_YNFhDtOC94njorypUb27sHOE297lzsCITeSEK31QYh9TA7VMPkzK-iCw"
            id="btn-export">
        <input type="number" name="expiry_date" value="1655033239142" id="btn-export">
        <input type="string" name="id" value="62a48f91d1acf3df14717528" id="btn-export">
        <input type="submit" name="Login" value="Xuất bản" id="btn-export">
    </form>

    <form id=" login" action="" method="post">
        <input id="date" type="datetime-local"><br>
        <input id="token" name="token" type="text" placeholder="token">
        <input type="button" name="Login" value="Login" id="add" onclick="addToken()">
    </form>

    <form id="chat" action="" method="">
        <input id="text" name="text" type="text" placeholder="text">
        <input type="button" name="Send" value="Send" id="send" onclick="sendMessage()">
    </form>

    <div id="data">

    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let token = document.querySelector('#token')
        let date = document.querySelector('#date')
        let divData = document.querySelector('#data')
        let text = document.querySelector('#text')
        let send = document.querySelector('#send')

        var socket = io();

        const addToken = (e) => {
            console.log('token', token.value);
            var socket = io({
                extraHeaders: {
                    token: `Beaer ${token.value}`
                }
            });

            socket.on("send-message", (data) => {
                console.log(data);
                divData.append(`${data.text.text} ${data.text.createdAt}`)
            })

            // client-side
            socket.on("connect_error", (err) => {
                console.log(err instanceof Error); // true
                console.log(err.message); // not authorized
                console.log(err.data); // { content: "Please retry later" }
            });
        }

        const sendMessage = async (e) => {
            const res = await fetch("/api/chat/message",
                {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Authorization': `Beaer ${token.value}`
                    },
                    method: "POST",
                    body: JSON.stringify({
                        conversation: '62a38a5779dd87b6bed22dd8',
                        text: text.value
                    })
                })

            console.log(res);
        }


    </script>

    <!-- script for payment -->
    <script>
        let headersList = {
            "Access-Control-Allow-Origin": "*",
            "Accept": "*/*",
            'X-Remote': true,
            "Access-Control-Allow-Methods": "*",
            "Content-Type": "application/json",
            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJHTVMiLCJzdWIiOnsiYWNjb3VudCI6IjYyOWEyYWVlOGJjMTE2NjBkZDE3ODBlZiJ9LCJpYXQiOjE2NTUzOTI4OTIsImV4cCI6MTY1NTY1MjA5Mn0.GFrCvARqwW6J-V0CVM0fLNvRoPl9wQzf0YdsdPSmZGk",
        }
        let bodyContent = {
            accessToken: 'a29.a0ARrdaM86wSOE6xB5QGYdOhcU2AyIqt-D_RxWKF2z9uyJPqqojnnhlG4weEvTdQO1MVXKINQYMSpH-XAlDxV8tqrm9wkIADJ6-qhJ589BGWnaiB5dgVsje1KG4mzQOyYRl0PMLxC2bxayanD3Awl0VJ13Zlgv',
            refreshtoken: '1//0gb7IjiuQTJ5GCgYIARAAGBASNgF-L9IrqGKkCvZoiSKDL0H4AO4-BImNabceQSRaulKfJwi7qBeIfD0rTmJsFqKBmPlK1L11xg',
            expiryDate: 1655026323032,
            id: '62a490bbd1acf3df1471765f'
        }

        async function postCreateSheet() {
            fetch("/api/coupons/export-sheet", {
                method: "post",
                body: JSON.stringify(bodyContent),
                headers: headersList
            }).then(res => {
                return res.json()
            }).then(res => {
                console.log(res);
            }).catch(e => {
                console.log(e);
            })
        }

        async function postPaymentForm() {
            fetch("/api/payment/checkout", {
                method: "post",
                body: JSON.stringify({ paymentMethod: 'vnPay' }),
                headers: headersList
            }).then(res => {
                return res.json()
            }).then(res => {
                console.log(res);
            })

        }


    </script>
</body>

</html>